{% load static %}
{% load crispy_forms_tags %}
<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <title></title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="{% static  'css/business.css' %}" rel="stylesheet">
        <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
        <link rel="icon" type="image/x-icon" href="{%  static 'imgs/projects.jpeg' %}">
        <script src = "https://unpkg.com/sweetalert/dist/sweetalert.min.js "> </script> 
     
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="text/javascript">
  
    google.charts.load("current", {packages:['corechart']});
    google.charts.setOnLoadCallback(drawChart);
    function drawChart() {
      var data = google.visualization.arrayToDataTable([
        ["Element", "Ticket Máximo", { role: "style" } ];
        
        //["Total Prospect", 1 , "Blue"],
        {% for ticket, contagem in contagens.items %}
        ["Nº Clientes: {{contagem}} ", {{ticket}}, "blue"],
        {% endfor %}
        ]);

      var view = new google.visualization.DataView(data);
      view.setColumns([0, 1,
                       { calc: "stringify",
                         sourceColumn: 1,
                         type: "string",
                         role: "annotation" },
                       2]);

      var options = {
        title: "Business Intelligence",
        width: 600,
        height: 400,
        bar: {groupWidth: "95%"},
        legend: { position: "none" },
      };
      var chart = new google.visualization.ColumnChart(document.getElementById("columnchart_values"));
      chart.draw(view, options);
  }
  </script>

    </head>
    <body>
    {% if request.user.is_authenticated %}
    <div class="container">
    <header class="header">
    <strong><a href="{% url 'your-business' %}"  style="color:white;margin-top:x;" >Voltar</a></strong>
  <div class="sidebar">
    <ul class="menu" >
    {% if user.perfil.foto_perfil %}
    <li><a style="color:black; " href="#"><img src="{{ user.perfil.foto_perfil.url }}" alt="retrato" width="50" height="50"></a>
    {% else %}
    <li><a href="" style="color:white;" ><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-person-circle" viewBox="0 0 16 16">
  <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/>
  <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z"/>
</svg></a>
    {% endif %}
    <ul>
      <li><a href="{% url 'user_list' %}">Users</a></li>
      <li><a href="{% url 'resetnewpassword' %}">Alterar Senha</a></li>
      <li><a href="{% url 'perfil-update' %}">Perfil</a></li>
      <li><a href="{% url 'logout' %}">Sair</a></li>
    </ul>
 </ul>
  </header>
  </div>
</div>

<div class="container">
<h3 style="text-align:center; color:white; margin-top:px;" href="#" style="color:white; ">Chart of Sales 
<svg xmlns="http://www.w3.org/2000/svg" style="margin-top: -12px;" width="30" height="25" fill="currentColor" class="bi bi-bar-chart-fill" viewBox="0 0 16 16">
  <path d="M1 11a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1v-3zm5-4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v7a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V7zm5-5a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1V2z"/>
</svg></h3>



<br>

<div id="columnchart_values" style="width: 700px; height: 200px;
margin: 0 auto;
width: 65%;

@media screen and (max-width: 750px) {
	 {
		max-width: 70%;
	}
}
"></div>
    

  
<!--Se eu tiver uma página anterior -->
<nav aria-label="Page navigation example">
    <ul class="pagination">
    {% if page_obj.has_previous %}
      <li class="page-item"><a class="btn btn-light" style="margin-left:300px; margin-top:-350px;" class="page-link" aria-label="Previous" href="?page{{page_obj.previous_page_number}}">
      <span aria-hidden="true">&laquo;</span>
      </a></li>
      <li class="page-item" ><a class="btn btn-light" style="margin-top:-350px; margin-left:-10px;"  class="page-link" href="?page=1">1</a></li>
      <li class="page-item"><a class="btn btn-light"  style="margin-top:-350px;margin-left:-10px;"  class="page-link"  href="?page=2">2</a></li>
    {% endif %}

    {% if page_obj.has_next %}
      <li class="page-item"><a class="btn btn-light" class="page-link" style="margin-left: 300px; margin-top: -370px;" href="?page={{page_obj.next_page_number}}">Next
      
      </a></li>
      </ul>
</nav>
</div>
</div>
    {% endif %}

{% endif %}

    </body>
</html>
<script>
const hamburgerMenu = document.querySelector('.hamburger-menu');
    const menu = document.querySelector('.menu');
    hamburgerMenu.addEventListener('click', () => {
    menu.classList.toggle('active');
    });
</script>

<!-- Alerta java script ao salvar os dados -->
{% if messages %}
    {% for message in messages %}
        <!--O SweetAlert torna as mensagens pop-up fáceis e bonitas.-->
        <script type="text/javascript">
          swal("{{ message }}",{
          buttons: false,});
          
          setTimeout(function() {
          swal.close(); 
          
        }, 1000); // Tempo em milissegundos (1000 = 1 segundo)
        
        //No exemplo acima, um diálogo modal com a mensagem "Hello world!" é exibido usando 
        //o swal()método. Após três segundos, o swal.close()método é chamado para fechar a caixa de diálogo.
        </script>
    {% endfor %}
{% endif %}

 <script>
    function downloadPNG() {
      // URL do arquivo PNG
      var url = "{% url 'export' %}";

      // Nome do arquivo para download
      var fileName = 'chart.png';

      var link = document.getElementById('columnchart_values');
      link.href = url;
      link.download = fileName;
      link.click();
    }

    // Chame a função para fazer o download
    downloadPNG();
  </script>
</html>
